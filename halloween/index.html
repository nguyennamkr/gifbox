<!DOCTYPE html><html lang="vi"><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>ğŸ’Œ Báº¥t Ngá» Cho Em ğŸ’</title><style>body{background-color:#f7f0ff;font-family:Arial,sans-serif;display:flex;justify-content:center;align-items:center;min-height:100vh;margin:0;overflow:hidden;perspective:1000px;background-image:radial-gradient(#ffe6f2 1px,transparent 0);background-size:20px 20px}#magicCanvas{position:fixed;top:0;left:0;width:100%;height:100%;z-index:0;opacity:.5}#mainContainer{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);display:flex;justify-content:center;align-items:center;width:100%;height:100%;z-index:100}#pinScreen{position:fixed;top:0;left:0;width:100vw;height:100vh;background-color:#f7f0ff;z-index:1000;display:flex;flex-direction:column;justify-content:center;align-items:center;transition:opacity .5s}#pinScreen.hidden{opacity:0;pointer-events:none}#pinDisplay{font-family:monospace;font-size:2.5em;letter-spacing:10px;border-bottom:3px solid pink;padding:10px;min-width:280px;text-align:center;color:#333;margin-bottom:30px;user-select:none}#pinMessage{color:#ff4d4d;height:20px;margin-bottom:10px;font-weight:700}#keypad{display:grid;grid-template-columns:repeat(3,1fr);gap:15px;width:300px}@keyframes shake{0%{transform:translateX(0)}20%{transform:translateX(-10px)}40%{transform:translateX(10px)}60%{transform:translateX(-8px)}80%{transform:translateX(8px)}100%{transform:translateX(0)}}.pin-button{background-color:#fff;border:2px solid pink;color:#ff69b4;font-size:1.5em;font-weight:700;padding:15px 0;border-radius:10px;cursor:pointer;transition:background-color .1s,transform .1s;box-shadow:0 4px pink}.pin-button:active{background-color:pink;color:#fff;transform:translateY(4px);box-shadow:0 0 pink}.action-btn{background-color:#eee;color:#666;box-shadow:0 4px #ccc}.action-btn:active{background-color:#ccc;color:#333;box-shadow:0 0 #ccc}#soundToggle{position:fixed;top:15px;right:15px;font-size:24px;cursor:pointer;color:#ff69b4;z-index:300;transition:color .3s,transform .2s}#soundToggle:hover{color:pink;transform:scale(1.1) rotate(5deg)}.heart-wrapper{position:absolute;z-index:200;display:flex;justify-content:center;align-items:center;width:100%;height:100%;transition:opacity .3s ease-out,transform .3s ease-out;opacity:0;pointer-events:none;transform-style:preserve-3d}.heart-wrapper.active{opacity:1;pointer-events:all}.css-heart{position:relative;width:150px;height:150px;background-color:#ff4d4d;animation:pulse-heart 1s infinite ease-in-out;transform:rotate(-45deg);box-shadow:0 10px 30px rgba(255,77,77,.7),-5px 5px 20px rgba(255,105,180,.5);cursor:pointer;transition:box-shadow .2s;transform-origin:center center}.css-heart::after,.css-heart::before{content:"";position:absolute;width:150px;height:150px;border-radius:50%;background-color:#ff4d4d;transform-origin:50% 50%}.css-heart::before{top:-75px;left:0}.css-heart::after{left:75px;top:0}@keyframes pulse-heart{0%{transform:scale(.9) rotate(-45deg);filter:brightness(1)}50%{transform:scale(1.2) rotate(-45deg);filter:brightness(1.2)}100%{transform:scale(.9) rotate(-45deg);filter:brightness(1)}}.heart-wrapper.hidden{opacity:0;transform:scale(.5) translateY(-50px);pointer-events:none;animation:none!important}.heart-wrapper.invisible{display:none}.envelope-wrapper{position:relative;width:350px;height:220px;cursor:pointer;z-index:210;transition:transform .8s,opacity .8s,box-shadow .5s;box-shadow:0 10px 50px rgba(255,105,180,.7);transform:scale(.95);overflow:hidden;border-radius:5px;opacity:0;pointer-events:none;perspective:1000px}.envelope-wrapper.active{pointer-events:all}.envelope-wrapper.visible{opacity:1;animation:pulse-envelope 2s infinite ease-in-out}@keyframes pulse-envelope{0%{transform:scale(.95)}50%{transform:scale(1.02)}100%{transform:scale(.95)}}.flap{position:absolute;top:0;left:0;width:100%;height:100%;background-color:pink;border-radius:5px;z-index:50;transform-origin:top;transition:transform .8s ease-in-out;clip-path:polygon(0 0,100% 0,50% 50%,0 0);box-shadow:0 5px 15px rgba(0,0,0,.2)}.envelope{width:100%;height:100%;background-color:#fce4ec;border-radius:5px;position:absolute;z-index:40}.envelope-wrapper.open .flap{transform:rotateX(180deg);z-index:30}.letter{position:absolute;top:0;left:0;width:100%;height:100%;background-color:#fff;padding:20px;box-sizing:border-box;border-radius:10px;opacity:0;pointer-events:none;z-index:45;transition:all 1.4s cubic-bezier(.68, -.55, .265, 1.55);box-shadow:0 0 15px rgba(0,0,0,.2);background-image:radial-gradient(circle at 10% 20%,rgba(255,229,165,.8) 0,rgba(250,190,123,.8) 90%),url('data:image/svg+xml,%3Csvg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"%3E%3Cg fill="%23fce4ec" fill-opacity="0.5"%3E%3Cpath d="M25 18a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H23a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zm10 0a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-2a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zm-20 10a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zM35 28a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-2a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zM15 38a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H13a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zm20 0a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-2a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zM25 48a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H23a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zm10 0a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-2a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zM5 58a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zm10 0a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H13a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zM35 58a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-2a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zM25 68a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H23a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zm10 0a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-2a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zM15 78a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H13a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zm20 0a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-2a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zM5 88a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H3a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zm25 8a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-2a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zm-10 0a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H23a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zm30-90a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H53a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zM65 8a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H63a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zM55 18a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H53a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zM85 18a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-2a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zM65 28a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H63a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zM95 28a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H93a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zM55 38a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H53a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zM85 38a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-2a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zM75 48a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H73a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zM95 48a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H93a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zM65 58a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H63a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zM85 58a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-2a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zM55 68a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H53a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zM75 68a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H73a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zM95 68a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H93a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zM65 78a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H63a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zM95 78a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H93a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zM55 88a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H53a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zM85 88a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2h-2a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2zM75 98a2 2 0 0 1 2 2v4a2 2 0 0 1-2 2H73a2 2 0 0 1-2-2v-4a2 2 0 0 1 2-2h2z" /%3E%3C/g%3E%3C/svg%3E');background-size:cover,50px 50px;transform-origin:center center;transform-style:preserve-3d}.envelope-wrapper.open .letter{transform:translateY(-20px) scale(.5) rotateX(10deg);opacity:1;transition:opacity .5s ease-out,transform .8s ease-out}.letter.opened{position:fixed;opacity:1;pointer-events:all;z-index:999;width:auto;height:auto;min-width:300px;min-height:400px;max-width:500px;max-height:600px;top:50%;left:50%;transform:translate(-50%,-50%) scale(1.3) rotateX(15deg) rotateY(10deg) rotateZ(-5deg) translateZ(200px);transition:all 1.4s cubic-bezier(.68, -.55, .265, 1.55);border:5px solid #ff69b4;box-shadow:0 0 50px rgba(255,105,180,.9);border-radius:10px;padding:25px}.letter.opened.final-scale{transform:translate(-50%,-50%) scale(1) rotateX(0) rotateY(0) rotateZ(0) translateZ(0);transition:all .3s ease-out}.envelope-wrapper.hidden{opacity:0;pointer-events:none;transform:scale(0);animation:none!important}@media (max-width:600px){.envelope-wrapper{width:300px;height:180px;perspective:800px}.letter.opened{width:80vw;height:70vh;max-width:90vw;max-height:90vh;padding:15px}.css-heart{width:120px;height:120px}.css-heart::after,.css-heart::before{width:120px;height:120px}.css-heart::before{top:-60px;left:0}.css-heart::after{left:60px;top:0}#keypad{width:250px;gap:10px}}.letter-content{display:flex;flex-direction:column;justify-content:center;align-items:center;overflow-y:hidden;text-align:center;color:#333;font-size:1.1em;line-height:1.6;width:100%;height:100%;box-sizing:border-box;padding:0}.letter-content>*{max-width:100%;margin:5px 0}.letter-content h2{color:#ff69b4;margin-top:0;font-size:1.8em;text-shadow:1px 1px 2px rgba(255,192,203,.5)}.letter-content.typing-active p{opacity:0}.letter-content.typing-active h2{opacity:0}.status-message{position:absolute;bottom:-50px;color:pink;font-style:italic;font-size:.9em;width:100%;text-align:center;animation:pulse 2s infinite;z-index:10}@keyframes pulse{0%{opacity:.8}50%{opacity:1}100%{opacity:.8}}.confetti{position:fixed;top:-10px;left:0;width:10px;height:10px;border-radius:50%;pointer-events:none;opacity:0;z-index:1000}.confetti.heart{background-color:transparent;width:12px;height:12px;transform:rotate(-45deg)}.confetti.heart::after,.confetti.heart::before{content:"";position:absolute;width:12px;height:12px;border-radius:50%;background-color:inherit}.confetti.heart::before{top:-6px;left:0}.confetti.heart::after{left:6px;top:0}@keyframes fall{to{transform:translate3d(var(--x),var(--y),0) rotate(var(--r));opacity:0}}#pumpkin{position:fixed;top:20px;left:20px;width:60px;height:60px;background-color:#ff7518;border-radius:50%;cursor:pointer;box-shadow:0 4px 10px rgba(0,0,0,.5),0 0 15px rgba(255,117,24,.7);z-index:500;transition:transform .2s;animation:breathe-pumpkin 3s infinite ease-in-out;border:2px solid #500}#pumpkin:hover{transform:scale(1.1) rotate(-5deg)}#pumpkin::before{content:"";position:absolute;top:-10px;left:50%;transform:translateX(-50%);width:10px;height:10px;background-color:#228b22;border-radius:3px}#pumpkin::after{content:"ğŸ‘»";position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);font-size:30px;line-height:1;text-shadow:1px 1px 2px #000}@keyframes breathe-pumpkin{0%,100%{transform:scale(1) rotate(0)}50%{transform:scale(1.05) rotate(2deg)}}#scareModal{position:fixed;top:0;left:0;width:100vw;height:100vh;background-color:rgba(0,0,0,.85);z-index:5000;display:none;justify-content:center;align-items:center;opacity:0;transition:opacity .5s}#scareModal.active{display:flex;opacity:1}.modal-content{background-color:#300;border:5px solid #ff4500;border-radius:15px;padding:40px;max-width:400px;text-align:center;box-shadow:0 0 50px rgba(255,69,0,.9);transform:scale(.8);animation:modal-pop-in .4s forwards}@keyframes modal-pop-in{to{transform:scale(1)}}.modal-content h2{color:gold;font-size:2.2em;text-shadow:2px 2px #ff4500;margin-bottom:20px;animation:text-flicker 1.5s infinite alternate}.modal-content p{color:#fff;font-size:1.1em;margin-bottom:30px;font-style:italic}@keyframes text-flicker{0%{opacity:1;text-shadow:2px 2px #ff4500}50%{opacity:.8;text-shadow:none}100%{opacity:1;text-shadow:2px 2px #ff4500}}.love-button{background-color:#ff4d4d;color:#fff;border:none;padding:12px 30px;font-size:1.2em;font-weight:700;border-radius:50px;cursor:pointer;box-shadow:0 5px #c00;transition:all .1s}.love-button:active{transform:translateY(5px);box-shadow:0 0 #c00}</style><canvas id="magicCanvas"></canvas><div id="soundToggle">ğŸ”‡</div><audio id="bgm" loop><source src="halloween_music.mp3" type="audio/mpeg"></audio><audio id="scarySound"><source src="scary_scream.mp3" type="audio/mpeg"></audio><audio id="pin_0_sound"><source src="pin_0.mp3" type="audio/mpeg"></audio><audio id="pin_1_sound"><source src="pin_1.mp3" type="audio/mpeg"></audio><audio id="pin_2_sound"><source src="pin_2.mp3" type="audio/mpeg"></audio><audio id="pin_3_sound"><source src="pin_3.mp3" type="audio/mpeg"></audio><audio id="pin_4_sound"><source src="pin_4.mp3" type="audio/mpeg"></audio><audio id="pin_5_sound"><source src="pin_5.mp3" type="audio/mpeg"></audio><audio id="pin_6_sound"><source src="pin_6.mp3" type="audio/mpeg"></audio><audio id="pin_7_sound"><source src="pin_7.mp3" type="audio/mpeg"></audio><audio id="pin_8_sound"><source src="pin_8.mp3" type="audio/mpeg"></audio><audio id="pin_9_sound"><source src="pin_9.mp3" type="audio/mpeg"></audio><audio id="pinClickSound"><source src="pin_click.mp3" type="audio/mpeg"></audio><audio id="envelopeOpenSound"><source src="envelope_open.mp3" type="audio/mpeg"></audio><audio id="typewriterStartSound"><source src="typewriter_start.mp3" type="audio/mpeg"></audio><div id="pumpkin"></div><div id="scareModal"><div class="modal-content"><h2>HALLOWEEN áº¢NH HÆ¯á»NG TÃ TEO!</h2><p>Em dÃ¡m nhÃ¬n tháº³ng vÃ o Ä‘Ã´i máº¯t nÃ y sao? ğŸ˜ˆ HÃ£y nhá»› ráº±ng dÃ¹ Ä‘Ã¡ng sá»£ Ä‘áº¿n máº¥y, thÃ¬ Anh váº«n sáº½ cháº¡y vá» hÆ°á»›ng Ä‘Ã³, hÆ°á»›ng nÃ o Ã¡? Äá»‘ Em biáº¿t ğŸ¥°</p><button class="love-button" onclick="hideScaryModal()">CÆ¯á»œI Má»ˆM trÆ°á»›c khi Báº¤M â¤ï¸</button></div></div><div id="pinScreen"><h2 style="color:#ff69b4;margin-bottom:30px">Vá»«ng Æ i Má»Ÿ Cá»­a ğŸ”’</h2><div id="pinDisplay">_ _ _ _</div><div id="pinMessage"></div><div id="keypad"><button class="pin-button">1</button> <button class="pin-button">2</button> <button class="pin-button">3</button> <button class="pin-button">4</button> <button class="pin-button">5</button> <button class="pin-button">6</button> <button class="pin-button">7</button> <button class="pin-button">8</button> <button class="pin-button">9</button> <button class="pin-button action-btn" data-action="delete">âŒ«</button> <button class="pin-button">0</button> <button class="pin-button action-btn" data-action="enter">OK</button></div></div><div id="mainContainer"><div class="heart-wrapper" id="heartWrapper"><div class="css-heart" id="initialHeart"></div></div><div class="envelope-wrapper" id="envelopeWrapper"><div class="flap"></div><div class="envelope"></div><div class="letter" id="letter"><div class="letter-content" id="letterContent"></div></div><p class="status-message" id="statusMessage">Cháº¡m vÃ o trÃ¡i tim Ä‘á»ƒ báº¯t Ä‘áº§u...</div></div><script>const pinClickSound=document.getElementById("pinClickSound"),envelopeOpenSound=document.getElementById("envelopeOpenSound"),typewriterStartSound=document.getElementById("typewriterStartSound"),scarySound=document.getElementById("scarySound"),pinSounds={};for(let t=0;t<=9;t++)pinSounds[t.toString()]=document.getElementById(`pin_${t}_sound`);function playSound(t,e=1){isMuted||(t.currentTime=0,t.volume=e,t.play().catch(t=>console.log("Lá»—i phÃ¡t Ã¢m thanh hiá»‡u á»©ng:",t)))}const canvas=document.getElementById("magicCanvas"),ctx=canvas.getContext("2d");let width=window.innerWidth,height=window.innerHeight;canvas.width=width,canvas.height=height;let particles=[];const particleCount=120;class Particle{constructor(){this.reset()}reset(){this.x=Math.random()*width,this.y=Math.random()*height,this.size=2*Math.random()+1,this.speedX=.1*Math.random(),this.speedY=1.5*Math.random()+1,this.opacity=.7*Math.random()+.5,this.color=Math.random()>.5?"rgba(255, 105, 180, ":"rgba(199, 21, 133, "}draw(){ctx.fillStyle=this.color+this.opacity+")",ctx.beginPath();const t=this.size,e=this.x,n=this.y;ctx.moveTo(e,n+t/4),ctx.quadraticCurveTo(e+t,n-t,e+t,n),ctx.quadraticCurveTo(e+t,n+t,e,n+2*t),ctx.quadraticCurveTo(e-t,n+t,e-t,n),ctx.quadraticCurveTo(e-t,n-t,e,n+t/4),ctx.fill()}update(){this.x+=this.speedX,this.y+=this.speedY,this.y>height&&(this.reset(),this.y=0)}}function initCanvas(){for(let t=0;t<120;t++)particles.push(new Particle)}function animateCanvas(){ctx.fillStyle="rgba(247, 240, 255, 0.1)",ctx.fillRect(0,0,width,height),particles.forEach(t=>{t.update(),t.draw()}),requestAnimationFrame(animateCanvas)}window.addEventListener("resize",()=>{width=window.innerWidth,height=window.innerHeight,canvas.width=width,canvas.height=height,particles=[],initCanvas()}),initCanvas(),animateCanvas();const bgm=document.getElementById("bgm"),soundToggle=document.getElementById("soundToggle");let isMuted=!0,bgmUserInitiated=!1;function toggleSound(){isMuted?(bgm.muted=!1,bgm.play().catch(t=>{console.error("Lá»—i phÃ¡t nháº¡c:",t)}),soundToggle.textContent="ğŸ”Š",isMuted=!1,bgmUserInitiated=!0):(bgm.pause(),bgm.currentTime=0,soundToggle.textContent="ğŸ”‡",isMuted=!0,bgmUserInitiated=!1)}function handleVisibilityChange(){document.hidden?bgm.paused||isMuted||bgm.pause():bgmUserInitiated&&!isMuted&&bgm.play().catch(t=>console.log("Lá»—i tá»± Ä‘á»™ng phÃ¡t nháº¡c sau khi chuyá»ƒn tab:",t))}function applyTypewriterEffect(t,e=500){setTimeout(()=>{const e=t.querySelectorAll("h2, p");t.classList.add("typing-active"),playSound(typewriterStartSound,.5);let n=0;e.forEach(t=>{const e=t.innerHTML;t.innerHTML="",t.style.opacity="1",setTimeout(()=>{let n=0;!function i(){n<e.length&&(t.innerHTML+=e.charAt(n),n++,setTimeout(i,25))}()},n),n+=25*e.length+300})},e)}soundToggle.addEventListener("click",toggleSound),document.addEventListener("visibilitychange",handleVisibilityChange);const CORRECT_PIN="2929",MAX_PIN_LENGTH=4,SUCCESS_MESSAGE_DELAY=1e3,pinScreen=document.getElementById("pinScreen"),pinDisplay=document.getElementById("pinDisplay"),pinMessage=document.getElementById("pinMessage"),keypad=document.getElementById("keypad");let currentPin="";function updatePinDisplay(){let t=currentPin.padEnd(4,"_");pinDisplay.textContent=t.split("").join(" ")}function handleKeyPress(t){if(pinMessage.textContent="","delete"===t)playSound(pinClickSound,.5),currentPin=currentPin.slice(0,-1);else{if("enter"===t)return playSound(pinClickSound,.8),void checkPin();currentPin.length<4&&(pinSounds[t]?playSound(pinSounds[t],.3):playSound(pinClickSound,.3),currentPin+=t)}updatePinDisplay(),4===currentPin.length&&setTimeout(checkPin,300)}function checkPin(){4===currentPin.length?"2929"===currentPin?(pinMessage.textContent="Xin Má»i Em VÃ o â¤ï¸ A",setTimeout(()=>{pinScreen.classList.add("hidden"),setTimeout(showHeart,500)},1e3)):(pinMessage.textContent="Æ , Sai Rá»“i Ã€ ğŸ’”",currentPin="",updatePinDisplay(),keypad.style.animation="shake 0.5s",setTimeout(()=>{keypad.style.animation="none"},500)):pinMessage.textContent="4 chá»¯ sá»‘ mÃ  nÃ ng thÆ¡ Æ¡iiii"}keypad.addEventListener("click",t=>{if(t.target.classList.contains("pin-button")){const e=t.target.textContent,n=t.target.dataset.action;n?handleKeyPress(n):isNaN(parseInt(e))||handleKeyPress(e)}});const heartWrapper=document.getElementById("heartWrapper"),envelopeWrapper=document.getElementById("envelopeWrapper"),letter=document.getElementById("letter"),letterContent=document.getElementById("letterContent"),statusMessage=document.getElementById("statusMessage"),flapDuration=800,heartTransitionDuration=300,initialHeart=document.getElementById("initialHeart"),firstTimeContent='\n            <h2 style="color: #FF69B4;">ğŸ’– DÃ nh Cho Em ğŸ’Œ</h2>\n            <p style="margin-top: 10px;">ChÃ o Em BÃ© Nh (â‰§â—¡â‰¦) ğŸ¥°</p>\n            <p>Anh muá»‘n gá»­i má»™t chÃºt náº¯ng áº¥m vÃ  tháº­t nhiá»u chÃ¢n thÃ nh qua chiáº¿c thiá»‡p nhá» nÃ y. Cáº£m Æ¡n vÃ¬ Ä‘Ã£ nÃ³i chuyá»‡n vá»›i Anh; hy vá»ng sau nÃ y, sau nÃ y vÃ  sau nÃ y ná»¯a sáº½ Ä‘Æ°á»£c Ä‘á»“ng hÃ nh nhiá»u hÆ¡n cÃ¹ng Em.</p>\n            <p>ğŸ“ 1 chiáº¿c "CV" Ä‘ang Ä‘Æ°á»£c Anh viáº¿t cáº©n tháº­n, vá»›i sá»± nghiÃªm tÃºc Ä‘á»ƒ dÃ nh Ä‘Æ°á»£c sá»± "Æ°u tiÃªn" tá»« Em.</p>\n            <p style="color: #FF69B4; font-weight: bold;">â€” From ë‚¨ with... ğŸ’•</p>\n        ';function launchConfetti(t,e){const n=["#FF69B4","#FFC0CB","#FF4D4D","#FFFFAA"],i=document.body;for(let s=0;s<80;s++){const s=document.createElement("div");s.classList.add("confetti","heart");const a=n[Math.floor(Math.random()*n.length)];s.style.backgroundColor=a,s.style.left=`${t}px`,s.style.top=`${e}px`,s.style.opacity=1;const o=Math.random()*Math.PI*2,l=350*Math.random()+150,r=1080*Math.random()*2,c=Math.cos(o)*l,d=Math.sin(o)*l+150,p=1.5*Math.random()+1;s.style.setProperty("--x",`${c}px`),s.style.setProperty("--y",`${d}px`),s.style.setProperty("--r",`${r}deg`),s.style.animation=`fall ${p}s ease-out forwards`,i.appendChild(s),setTimeout(()=>{s.remove()},1e3*p)}}function checkAndSetContent(){letterContent.innerHTML=firstTimeContent,applyTypewriterEffect(letterContent,1e3),statusMessage.textContent="Vá»›i Anh Ä‘iá»u tuyá»‡t vá»i lÃ  Ä‘Æ°á»£c lÃ m Em Háº¡nh PhÃºc ğŸ’",statusMessage.style.color="#FF69B4",statusMessage.style.animation="none",statusMessage.style.bottom="20px",statusMessage.style.opacity="1"}function showHeart(){heartWrapper.classList.add("active"),heartWrapper.classList.remove("invisible","hidden"),envelopeWrapper.classList.remove("visible","active"),statusMessage.style.bottom="10px",statusMessage.textContent="Cháº¡m vÃ o trÃ¡i tim Ä‘á»ƒ báº¯t Ä‘áº§u..."}function showEnvelope(){const t=initialHeart.getBoundingClientRect();launchConfetti(t.left+t.width/2,t.top+t.height/2),heartWrapper.classList.remove("active"),envelopeWrapper.classList.add("visible","active"),heartWrapper.classList.add("hidden"),statusMessage.textContent="áº¤n vÃ o bÃ¬ thÆ° Ä‘á»ƒ má»Ÿ ra nhÃ©!",statusMessage.style.bottom="20px",envelopeWrapper.addEventListener("click",openEnvelope,{once:!0}),setTimeout(()=>{heartWrapper.classList.add("invisible")},300),isMuted&&(bgm.muted=!1,bgm.play().catch(t=>console.error("Lá»—i phÃ¡t nháº¡c ná»n sau tÆ°Æ¡ng tÃ¡c TrÃ¡i tim:",t)),isMuted=!1,bgmUserInitiated=!0,soundToggle.textContent="ğŸ”Š")}function openEnvelope(){envelopeWrapper.classList.remove("active"),envelopeWrapper.classList.add("open"),statusMessage.style.opacity="0",playSound(envelopeOpenSound,.7);const t=envelopeWrapper.getBoundingClientRect();letter.style.position="fixed",letter.style.top=`${t.top}px`,letter.style.left=`${t.left}px`,letter.style.width=`${t.width}px`,letter.style.height=`${t.height}px`,letter.style.opacity="1",document.body.appendChild(letter),setTimeout(()=>{envelopeWrapper.classList.add("hidden"),requestAnimationFrame(()=>{letter.style.top="",letter.style.left="",letter.style.width="",letter.style.height="",letter.classList.add("opened"),setTimeout(()=>{letter.classList.add("final-scale");const t=letter.getBoundingClientRect();launchConfetti(t.left+t.width/2,t.top+t.height/2),setTimeout(checkAndSetContent,500)},1200)})},900)}const pumpkin=document.getElementById("pumpkin"),scareModal=document.getElementById("scareModal");function showScaryModal(){scareModal.classList.add("active"),playSound(scarySound,.8)}function hideScaryModal(){scareModal.classList.remove("active")}function initializeApp(){heartWrapper.classList.add("invisible"),heartWrapper.addEventListener("click",showEnvelope,{once:!0}),updatePinDisplay()}pumpkin.addEventListener("click",showScaryModal),initializeApp()</script>